var app=angular.module("app","lbServices ngAnimate ngCookies ngMaterial dndLists ui.ace ui.router ui.bootstrap.contextMenu ui.bootstrap xeditable thilenius.navbar thilenius.sidebar thilenius.content_window".split(" "));app.run(["editableOptions",function(d){d.theme="bs3"}]);
app.config(["$httpProvider",function(d){d.interceptors.push(["$q","$location","LoopBackAuth",function(a,b,c){return{responseError:function(f){401===f.status&&(c.clearUser(),c.clearStorage(),b.nextAfterLogin=b.path(),b.path("/login"));return a.reject(f)}}}])}]);angular.module("app").config(["$stateProvider","$urlRouterProvider",function(d,a){d.state("login",{url:"/login",templateUrl:"app/components/login/login.html",controller:"loginController"}).state("create_user",{url:"/create_user",templateUrl:"app/components/create_user/create_user.html",controller:"createUserController"}).state("forge",{url:"/forge",templateUrl:"app/components/forge/forge.html",controller:"forgeController"});a.otherwise("forge")}]);var Differencer=function(){this.dmp=new diff_match_patch};
Differencer.prototype.patchesFromStrings=function(d,a){var b=this.dmp.diff_main(d,a);this.dmp.diff_cleanupSemantic(b);for(var b=this.dmp.patch_make(b),c=[],f=0;f<b.length;f++){var g=b[f],e=new Patch;e.diffs=[];e.from_span=new Span;e.from_span.from=g.start1;e.from_span.length=g.length1;e.to_span=new Span;e.to_span.from=g.start2;e.to_span.length=g.length2;for(var k=0;k<g.diffs.length;k++){var h=g.diffs[k],l=new Diff;h[0]==DIFF_INSERT?l.diff_type=DIFF_TYPE_INSERT:h[0]==DIFF_DELETE?l.diff_type=DIFF_TYPE_DELETE:
h[0]==DIFF_EQUAL&&(l.diff_type=DIFF_TYPE_EQUAL);l.text=h[1];e.diffs.push(l)}c.push(e)}return c};
Differencer.prototype.applyPatches=function(d,a){for(var b=[],c=0;c<a.length;c++){var f=a[c],g=new diff_match_patch.patch_obj;g.start1=f.from_span.from;g.length1=f.from_span.length;g.start2=f.to_span.from;g.length2=f.to_span.length;for(var e=0;e<f.diffs.length;e++){var k=f.diffs[e];k.diff_type==DIFF_TYPE_INSERT?g.diffs.push([DIFF_INSERT,k.text]):k.diff_type==DIFF_TYPE_DELETE?g.diffs.push([DIFF_DELETE,k.text]):k.diff_type==DIFF_TYPE_EQUAL&&g.diffs.push([DIFF_EQUAL,k.text])}b.push(g)}return this.dmp.patch_apply(b,
d)[0]};var isEmpty=function(d){return d&&0<d.length},isBlank=function(d){return!d||/^\s*$/.test(d)};String.prototype.toPascalCase=function(){return this.replace(/\w\S*/g,function(d){return d.charAt(0).toUpperCase()+d.substr(1).toLowerCase()})};String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)};angular.module("app").controller("createUserController",["$location","$rootScope","$scope","Person",function(d,a,b,c){b.createAccount=function(){b.createCredentials.email=b.createCredentials.email.toLowerCase();c.create(b.createCredentials,function(a){},function(a){b.error="Woops, something isn't right"})}}]);var forgeApp=angular.module("app");
forgeApp.controller("forgeController",["$rootScope","$scope","$location","$mdDialog","atTextDialog","Person","Project","Workspace","SourceFile",function(d,a,b,c,f,g,e,k,h){a.forgeVersion=window.FORGE_VERSION;window.Person=g;window.Project=e;window.Workspace=k;window.SourceFile=h;a.state={viewingAsRole:"student"};a.person=g.getCurrent(function(b){a.state.viewingAsRole=b.role});a.workspace=g.workspaces({id:g.getCurrentId(),filter:{include:{relation:"projects",scope:{include:{relation:"sourceFiles"}}}}}).$promise.then(function(b){a.workspace=b[0]});
a.addProject=function(){f({title:"Project Name",content:"New Project Name",done:function(b){k.projects.create({id:a.workspace.id},{name:b,config:""},function(b){a.projects.unshift(b)})}})};a.removeProject=function(b){c.show(c.confirm().title("Delete, are you sure?").textContent('Delete the project "'+b.name+'"? This cannot be undone!').ariaLabel("Delete Conformation").ok("Delete Permanently").cancel("Cancel")).then(function(){e.deleteById({id:b.modelId});a.projects=_(a.projects).without(b);g.prototype$updateAttributes({id:a.person.id},
a.person)})};a.addItemToProject=function(a,b,c){f({title:"Name",content:"New "+c.type.toUpperCase()+" Name",done:function(f){c.name=f;"file"===c.type&&e.sourceFiles.create({id:a.id},{},function(f){c.modelId=f.id;c.getModel=function(){return f};b.unshift(c);a.$save()})}})};a.renameItemInProject=function(a,b){f({title:"Rename",content:'Rename "'+b.name+'"...',placeholder:b.name,done:function(c){b.name=c;a.$save()}})};a.removeItemFromProject=function(a,b,f){var e=b[f],g='Are you sute you want to delete "'+
e.name+'"?',d="Delete";"directory"===e.type&&0<e.children.length&&(g="Are you sute you want to delete "+e.name+" and all items within it?",d="Delete Directory and Subitems");c.show(c.confirm().title("Delete, are you sure?").textContent(g).ariaLabel("Delete Conformation").ok(d).cancel("Cancel")).then(function(){b.splice(f,1);a.$save()})}}]);angular.module("app").controller("loginController",["$location","$rootScope","$scope","Person",function(d,a,b,c){b.login=function(){b.loginCredentials.email=b.loginCredentials.email.toLowerCase();c.login(b.loginCredentials,function(a){d.path("/forge")})}}]);angular.module("thilenius.ace_editor",[]).directive("atAceEditor",["$rootScope","$timeout",function(d,a){return{restrict:"AE",templateUrl:"app/directives/ace_editor/ace_editor.htm",link:function(a,c,f){}}}]);angular.module("thilenius.alerts_explorer",[]).directive("atAlertsExplorer",["$rootScope","billet",function(d,a){return{restrict:"AE",scope:{control:"="},templateUrl:"app/directives/alerts_explorer/alerts_explorer.htm",link:function(b,c,f){b.alerts=[];b.internalControl=b.control||{};d.$on("billet.alerts",function(a,c){b.$apply(function(){b.alerts=c})});a.currentAlerts&&(b.alerts=a.currentAlerts);b.jumpToAlert=function(a){d.$broadcast("alertExplorer.jumpToAlert",a)}}}}]);angular.module("thilenius.console_window",[]).directive("atConsoleWindow",["$sce","$rootScope","$timeout",function(d,a,b){return{restrict:"AE",scope:{control:"=",show:"="},templateUrl:"app/directives/console_window/console_window.htm",link:function(a,b,d){a.content=[];a.show=!1;a.activeRegion=null;a.internalControl=a.control||{};a.escapeCodes={"[0m":"<span class='console-text' style='color: white;'>","[31m":"<span class='console-text' style='color: #FF0000;'>","[32m":"<span class='console-text' style='color: #00FF00;'>",
"[33m":"<span class='console-text' style='color: yellow;'>","[36m":"<span class='console-text' style='color: #00D8FF;'>"}}}}]);angular.module("thilenius.content_window",["thilenius.console_window","thilenius.ace_editor"]).directive("atContentWindow",["$rootScope","$timeout",function(d,a){return{restrict:"AE",scope:{control:"="},templateUrl:"app/directives/content_window/content_window.htm",link:function(a,c,f){}}}]);angular.module("thilenius.history_explorer",[]).directive("atHistoryExplorer",["$rootScope",function(d){return{restrict:"AE",scope:{control:"="},templateUrl:"app/directives/history_explorer/history_explorer.htm",link:function(a,b,c){a.canRevert=!1;a.fileRelativePath=null;a.hasSelection=!1;a.repoName=null;a.selectedFile=null;a.historyTree={parents:[]};a.internalControl=a.control||{};a.$watch("historyTree.selected",function(b,c){b&&(a.canRevert=b!==a.historyTree.parents[0].children[0],d.$broadcast("historyExplorer.snapshotSelected",
b.repo,b.relativePath,b.changeList))});a.revertToCl=function(){if(a.selectedFile&&a.canRevert){var b=a.historyTree.selected.repo,c=b.reconstructFilesForCL(a.historyTree.selected.changeList.change_list_uuid)[a.selectedFile].source;a.historyTree.selected.repo.commit(a.selectedFile,c);a.internalControl.setRepoFile(b,a.selectedFile)}};a.internalControl.setRepoFile=function(b,c){if(b&&c){a.hasSelection=!0;var e=b.repoProto,d=a.filterChangelistsAndReverse(e.change_lists,c);a.repoName=e.repo_header.repo_name;
a.fileRelativePath=c;for(var e={parents:[]},h={},l=[],n=0;n<d.length;n++){var p=d[n],m=new Date(parseInt(p.timestamp)),m=m.toLocaleDateString()+" - "+m.getHours()+":00";h[m]||(h[m]=[],l.push(m));h[m].push(p)}for(d=0;d<l.length;d++){n=h[l[d]];p={label:l[d],children:[]};for(m=0;m<n.length;m++){var q=n[m];p.children.push({label:(new Date(parseInt(q.timestamp))).toLocaleTimeString(),repo:b,relativePath:c,changeList:q})}e.parents.push(p)}0<e.parents.length&&(e.parents[0].expanded=!0,0<e.parents[0].children.length&&
(e.selected=e.parents[0].children[0]));a.historyTree=e;a.canRevert=!1;a.selectedFile=c}else a.hasSelection=!1,a.repoName=null,a.fileRelativePath=null};a.filterChangelistsAndReverse=function(a,b){for(var c=[],d=0;d<a.length;d++){for(var h=a[d],l=!1,n=0;n<h.modified_files.length;n++)if(h.modified_files[n].file_info.relative_path===b){l=!0;break}l&&c.unshift(h)}return c}}}}]);angular.module("thilenius.navbar",[]).directive("atNavbar",["$rootScope","$location","Person",function(d,a,b){return{templateUrl:"app/directives/navbar/navbar.htm",link:function(c,d,g){c.logout=function(){b.logout();a.path("/login")}}}}]);var SETTINGS_COOKIE_KEY="scorch_forge_settings";
angular.module("thilenius.settings_window",[]).directive("atSettingsWindow",["$sce","$rootScope","$cookies",function(d,a,b){return{restrict:"AE",scope:{control:"="},templateUrl:"app/directives/settings_window/settings_window.htm",link:function(c,d,g){c.defaultSettings={foldStyle:"markbegin",fontSize:"12px",fullLineSelection:!0,highlightActiveLine:!0,highlightSelectedWord:!0,keyBinding:"ace",scrollPastEnd:!0,showGutter:!0,theme:"ace/theme/twilight",displayIndentGuides:!1,showInvisibles:!1,showPrintMargin:!0,
fadeFoldWidgets:!1};c.settings=jQuery.extend({},c.defaultSettings);a.editorSettings=c.settings;c.resetSettings=function(){a.editorSettings=c.settings=jQuery.extend({},c.defaultSettings)};if(d=b.get(SETTINGS_COOKIE_KEY))d=JSON.parse(d),c.settings=jQuery.extend(c.settings,d);a.$watchCollection("editorSettings",function(a,d){a&&b.put(SETTINGS_COOKIE_KEY,JSON.stringify(c.settings))})}}}]);angular.module("thilenius.sidebar",[]).directive("atSidebar",["$rootScope","$mdDialog","atTextDialog","Person","Project","SourceFile",function(d,a,b,c,f,g){return{restrict:"AE",templateUrl:"app/directives/sidebar/sidebar.htm",link:function(a,b,c){a.sidebarState={};a.saveProject=function(a){a.$save()};b=function(b){a.removeProject(b.projectMeta)};c=function(b){a.addItemToProject(b.project,b.item?b.item.children:b.project.metadata.fileTree,{type:"file"})};var d=function(b){a.addItemToProject(b.project,
b.item?b.item.children:b.project.metadata.fileTree,{type:"directory",isExpanded:!0,children:[]})},f=function(b){a.renameItemInProject(b.project,b.item)},g=function(b){a.removeItemFromProject(b.project,b.list,b.$index)};a.sidebarDropdown=[["New Project",function(b){a.addProject()}]];a.projectDropdown=[["Delete",b]];a.activeProjectDropdown=[["New Directory",d],["New File",c],["Recover Deleted File",function(a){}],null,["Delete",b]];a.directoryDropdown=[["New Directory",d],["New File",c],null,["Rename",
f],["Delete",g]];a.fileDropdown=[["View History",function(a){}],null,["Rename",f],["Delete",g]]}}}]);angular.module("app").factory("atTextDialog",["$mdDialog",function(d){return function(a){a.ok=a.ok||"Okay";a.cancel=a.cancel||"Cancel";a.noBlank=a.noBlank||!0;return d.show({controller:function(b,c){b.properties=a;b.model=a.placeholder||"";a.change&&b.$watch("model",function(c,d){a.change(b.model)});b.cancel=function(){c.cancel()};b.okay=function(){b.properties.noBlank&&isBlank(b.model)?c.cancel():(c.hide(b.model),b.properties.done&&b.properties.done(b.model))}},templateUrl:"app/factories/text_dialog/text_dialog.htm",
parent:angular.element(document.body),clickOutsideToClose:!0})}}]);angular.module("app").service("meta",function(){var d={},a={};this.toMeta=function(b){var c=d[b];c||(c={},d[b]=c,a[c]=b);return c};this.toModel=function(b){var c=a[b];c||(c={},a[b]=c,d[c]=b);return c};this.linkMeta=function(a,c,d){Object.getPrototypeOf(d);d.prototype.meta=function(){}}});
